<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gold Scalper Bot 2025</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { margin:0; font-family: Arial; background:#111; color:#0f0; }
    #chart { width:100%; height:60vh; }
    .panel { padding:10px; background:#222; text-align:center; }
    button { padding:15px 30px; margin:10px; font-size:18px; cursor:pointer; }
    .long { background:#0f0; color:black; border:none; }
    .short { background:#f00; color:white; border:none; }
    .auto { background:#00ffff; color:black; }
    .status { font-size:24px; color:#0f0; }
  </style>
</head>
<body>
  <div id="chart"></div>
  <div class="panel">
    <h1>âš¡ GOLD SCALPER BOT 2025 âš¡</h1>
    <div class="status" id="status">Connessione...</div>
    <div class="status" id="price">XAUUSD: ----</div>
    
    <button class="long" onclick="trade('buy')">BUY LONG</button>
    <button class="short" onclick="trade('sell')">SELL SHORT</button>
    <button class="auto" id="autoBtn" onclick="toggleAuto()">AUTO OFF</button>
  </div>

  <script>
    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      width: window.innerWidth,
      height: 500,
      layout: { backgroundColor: '#000', textColor: '#0f0' },
      grid: { vertLines: { color: '#333' }, horzLines: { color: '#333' } },
      crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
      timeScale: { timeVisible: true, secondsVisible: true }
    });
    const candleSeries = chart.addCandlestickSeries();

    const socket = io();

    let autoMode = false;

    socket.on('tick', (data) => {
      document.getElementById('price').innerText = `XAUUSD: ${data.bid.toFixed(2)}`;
      candleSeries.update(data);
      
      if(autoMode) {
        if (data.rsi < 30 && data.emaFast > data.emaSlow) trade('buy');
        if (data.rsi > 70 && data.emaFast < data.emaSlow) trade('sell');
      }
    });

    socket.on('connect', () => {
      document.getElementById('status').innerHTML = "ONLINE - BOT ATTIVO";
      document.getElementById('status').style.color = "#0f0";
    });

    socket.on('status', (msg) => {
      document.getElementById('status').innerHTML = msg;
    });

    function trade(side) {
      fetch('/api/trade', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ symbol: 'XAUUSD', side, volume: 0.10 })
      }).then(res => res.json()).then(data => {
        alert(data.success ? 'Trade OK: ' + data.message : 'Errore: ' + data.error);
      });
    }

    function toggleAuto() {
      autoMode = !autoMode;
      document.getElementById('autoBtn').innerText = autoMode ? "AUTO ON ðŸ”¥" : "AUTO OFF";
      document.getElementById('autoBtn').style.background = autoMode ? "#ff0" : "#00ffff";
    }
  </script>
</body>
</html>
